[
 {
  "allow_guest": 0,
  "api_method": "work_order_item_code_fetch",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "event_frequency": "All",
  "modified": "2024-03-05 12:22:31.153894",
  "module": "Advantisquartz",
  "name": "Work Order Item Code Fetch",
  "reference_doctype": "Stock Entry",
  "script": "work_order = frappe.form_dict['work_order']\nwork_order_items = frappe.get_all(\"Work Order Item\", filters={'parent': work_order}, fields=['item_code', 'idx'], order_by='idx ASC')\nfrappe.response[\"work_order_items\"] = work_order_items",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Submit",
  "event_frequency": "All",
  "modified": "2024-02-29 11:51:27.999128",
  "module": "Advantisquartz",
  "name": "stock qty",
  "reference_doctype": "Delivery Note",
  "script": "for item in doc.items:\n    rounded_stock_qty = round(item.stock_qty)\n    frappe.msgprint(str(item.serial_no))\n    frappe.msgprint(str(rounded_stock_qty))\n    \n    # Assuming 'Delivery Note Item' is the child table name\n    item.stock_qty = rounded_stock_qty\n    frappe.db.set_value('Delivery Note Item', {'parent': doc.name, 'item_code': item.item_code}, 'stock_qty', rounded_stock_qty)\n\n\n\n    # serials = frappe.db.get_list('Serial No',\n    #     filters={\n    #         'item_code': item.item_code,\n    #         'status': 'Hold',\n    #         'packing_list':doc.packing_scanner\n    #     },\n    #     fields=['name'],\n    #     as_list=True\n    # )\n\n    # # Filter serial numbers based on the rounded_stock_qty\n    # filtered_serials = serials[:rounded_stock_qty]\n\n    # serial_names = [serial[0] for serial in filtered_serials]\n\n    # serial_id = '\\n'.join(serial_names)\n    \n    # frappe.msgprint(serial_id)\n    \n    # # Set the serial_id with line breaks in the 'Delivery Note Item'\n    # frappe.db.set_value('Delivery Note Item', {'parent': doc.name, 'item_code': item.item_code}, 'serial_no', serial_id)\n# total = 0\n# for item in doc.items:\n#     result = 1 / item.uom_conversion_value;\n#     amount = item.saleable_measurement * item.rate\n#     frappe.msgprint(str(amount))\n#     frappe.db.set_value('Delivery Note Item', {'parent': doc.name, 'item_code': item.item_code}, 'conversion_factor', result)\n    \n#     finalResult = float(item.qty*result);\n#     frappe.db.set_value('Delivery Note Item', {'parent': doc.name, 'item_code': item.item_code}, 'stock_qty', finalResult)\n#     frappe.db.set_value('Delivery Note Item', {'parent': doc.name, 'item_code': item.item_code}, 'amount', amount)\n#     frappe.db.set_value('Delivery Note Item', {'parent': doc.name, 'item_code': item.item_code}, 'base_amount', amount)\n#     frappe.db.set_value('Delivery Note Item', {'parent': doc.name, 'item_code': item.item_code}, 'net_amount', amount)\n#     frappe.db.set_value('Delivery Note Item', {'parent': doc.name, 'item_code': item.item_code}, 'base_net_amount', amount)\n    \n#     total = total + amount\n#     frappe.db.set_value('Delivery Note',{'name':doc.name},'total', amount)\n#     frappe.msgprint(str(total))\n# taxe_amount = doc.total \n# for index, item in enumerate(doc.taxes):\n#     if item.charge_type == \"On Net Total\":\n#         taxe = (doc.total * item.rate) / 100 \n#         taxe_amount = taxe_amount + taxe\n#         # Fetch the existing row from the child table by its index \n#         tax_row = frappe.get_doc('Sales Taxes and Charges', {'parent': doc.name, 'idx': index + 1}) \n#         # Adding 1 to the index to match the child table index \n#         # Update fields in the existing row with the new tax amount \n        \n#         # Update the 'total' field with the new tax amount \n#         frappe.msgprint(f'Tax Amount: {taxe}') \n#         tax_row.save() \n#         # Save the updated row \n#         # Optional: Display tax amount for each item \n     \n#     doc.reload()",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "event_frequency": "All",
  "modified": "2023-11-22 11:01:31.227938",
  "module": "Advantisquartz",
  "name": "GRN Obtain Average Rating",
  "reference_doctype": "Purchase Receipt",
  "script": "# total_rating = 0\n\n# for entry in doc.items:\n#     if entry.item_rating:\n#         total_rating += entry.item_rating\n\n# doc.average_rating = float(total_rating / len(doc.items)) if len(doc.items) else 0\n\ntotal_rating = sum(entry.item_rating for entry in doc.items if entry.item_rating is not None)\ndoc.average_rating = float(total_rating / len(doc.items)) if len(doc.items) else 0\n\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "event_frequency": "All",
  "modified": "2024-01-30 11:50:02.815511",
  "module": "Advantisquartz",
  "name": "booked qty",
  "reference_doctype": "Packing list",
  "script": "if doc.sales_order:\n    item_counts = {}\n    \n    for item in doc.items:\n        item_code = item.item_code\n        if item_code in item_counts:\n            item_counts[item_code] = item_counts[item_code] + 1\n        else:\n            item_counts[item_code] = 1\n        \n    for item_code, count in item_counts.items():\n        qty_sum = frappe.db.get_value('Sales Order Item', filters={'parent': doc.sales_order, \"item_code\": item_code}, fieldname=\"stock_qty\")\n        if qty_sum:\n            produce_qty = round(qty_sum) - count  \n        \n            \n            field_values = {\n            'picked_qty': count,\n            'production_quantity': produce_qty\n            }\n        \n        \n            frappe.db.set_value('Sales Order Item', {\n            'parent': doc.sales_order,\n            'item_code': item_code\n            }, field_values)\n        \n\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "event_frequency": "All",
  "modified": "2024-01-10 11:30:59.471134",
  "module": "Advantisquartz",
  "name": "Get shift time",
  "reference_doctype": "Employee Checkin",
  "script": "Name = doc.name\nemp = doc.employee\ncheckin_time = doc.time\ndayShift_1 = doc.shift\nlog_type = doc.log_type\n\nTime = frappe.utils.get_datetime(checkin_time)\n\ntoday_time = frappe.utils.get_time(checkin_time)\n\ntoday_date = frappe.utils.get_date_str(checkin_time)\ntoday_date_notstr = Time.date()\ntoday = str(today_date_notstr)\n\ndoc.date = today_date_notstr\n\nyesterday_Date = frappe.utils.add_days(today_date, -1)\nyesterday_Date_str = str(yesterday_Date)\n\ntomorrow_date = frappe.utils.add_days(today_date, 1)\ntomorrow_date_str = str(tomorrow_date)\n\ndayData = frappe.db.get_value('Shift Type', dayShift_1, ['start_time','end_time', 'begin_check_in_before_shift_start_time','allow_check_out_after_shift_end_time','type'])\ndayStart = dayData[0] \ndayEnd = dayData[1]\n\nbefore_start = dayData[2]\nafter_end = dayData[3]\nshift_type = dayData[4]\n\nif shift_type == \"Day\":\n    day_start = today+\" \"+str(dayStart)\n    day_start_formated = frappe.utils.format_datetime(day_start,\"YYYY-MM-dd HH:mm:ss\")\n    day_before = frappe.utils.add_to_date(day_start_formated, minutes=-before_start)\n    Day_Actual_Start = frappe.utils.get_datetime(day_before)\n    # Day_Actual_Start = frappe.utils.format_datetime(day_before,\"YYYY-MM-dd HH:mm:ss\")\n    # Day_Actual_Start = frappe.utils.get_time(day_new_before)\n            \n    day_end = today+\" \"+str(dayEnd)\n    day_end_formatted = frappe.utils.format_datetime(day_end,\"YYYY-MM-dd HH:mm:ss\")\n    day_after = frappe.utils.add_to_date(day_end_formatted, minutes=after_end)\n    Day_Actual_End = frappe.utils.get_datetime(day_after)\n                \n    doc.shift_start = day_start_formated\n    doc.shift_end = day_end_formatted\n    doc.shift_actual_start = Day_Actual_Start\n    doc.shift_actual_end = Day_Actual_End\n                \n    # frappe.msgprint(str(day_start_formated))\n    # frappe.msgprint(str(day_end_formatted))\n    # frappe.msgprint(str(Day_Actual_Start))\n    # frappe.msgprint(str(Day_Actual_End))\n    \nif shift_type == \"Night\":\n    \n    if log_type == \"IN\":\n    \n        day_start = today+\" \"+str(dayStart)\n        day_start_formated = frappe.utils.format_datetime(day_start,\"YYYY-MM-dd HH:mm:ss\")\n        day_before = frappe.utils.add_to_date(day_start_formated, minutes=-before_start)\n        Day_Actual_Start = frappe.utils.get_datetime(day_before)\n        # frappe.msgprint(\"Night\")\n        \n        day_end = tomorrow_date_str+\" \"+str(dayEnd)\n        day_end_formatted = frappe.utils.format_datetime(day_end,\"YYYY-MM-dd HH:mm:ss\")\n        day_after = frappe.utils.add_to_date(day_end_formatted, minutes=after_end)\n        Day_Actual_End = frappe.utils.get_datetime(day_after)\n    \n        doc.shift_start = day_start_formated\n        doc.shift_end = day_end_formatted\n        doc.shift_actual_start = Day_Actual_Start\n        doc.shift_actual_end = Day_Actual_End\n    \n        # frappe.msgprint(str(day_start_formated))\n        # frappe.msgprint(str(day_end_formatted))\n        # frappe.msgprint(str(Day_Actual_Start))\n        # frappe.msgprint(str(Day_Actual_End))\n        \n    elif log_type == \"OUT\":\n        \n        night_record_yesterday_in = frappe.get_list(\"Employee Checkin\", filters={\"employee\": emp, \"date\":yesterday_Date, \"shift\":dayShift_1, 'log_type':\"IN\"}, fields=['name','shift_start','shift_end','shift_actual_start','shift_actual_end'])\n        \n        \n        if night_record_yesterday_in:\n            doc.shift_start = night_record_yesterday_in[0].shift_start\n            doc.shift_end = night_record_yesterday_in[0].shift_end\n            doc.shift_actual_start = night_record_yesterday_in[0].shift_actual_start\n            doc.shift_actual_end = night_record_yesterday_in[0].shift_actual_end\n    \n\n\n\n\n\n\n\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "event_frequency": "All",
  "modified": "2024-11-06 13:26:37.535083",
  "module": "Advantisquartz",
  "name": "Item Naming for finish goods",
  "reference_doctype": "Item",
  "script": "if doc is not None and doc.finish_good_:\n    new_item = \"S-\" + str(doc.finish_good_id) + \"-\" + str(doc.thickness)\n    frappe.rename_doc(\"Item\", doc.name, new_item, merge=False)\n    \n    # Show a message to the user with a link to the Items page\n    frappe.msgprint(\n        msg=f\"Item {doc.name} has been renamed to {new_item}. <a href='/app/item'>Go to Item List</a>\",\n        title=\"Item Renamed\",\n        indicator=\"green\"\n    )\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": "tax",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2024-03-28 11:52:20.144382",
  "module": "Advantisquartz",
  "name": "tax",
  "reference_doctype": null,
  "script": "a = frappe.form_dict[\"no\"]\n\nresult = frappe.db.sql(\"\"\"\n    SELECT it.gst_rate\n    FROM `tabItem Tax Template` it\n   \n    WHERE it.name = %s\n\"\"\", a)\n\n# Extract the tax rates from the result set\ntax_rates = [row[0] for row in result]\n\n# Compute the sum of tax rates\ntotal = sum(tax_rates)\ntotal_2 = str(total)\nfrappe.response[\"total\"]=total_2\n\n",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "event_frequency": "All",
  "modified": "2023-07-21 16:46:16.738716",
  "module": "Advantisquartz",
  "name": "Update GRN status in QC",
  "reference_doctype": "Purchase Receipt",
  "script": "if doc.gate_entry:\n    frappe.db.set_value(\"Gate Entry\",doc.gate_entry,'grn',1);\n    frappe.db.commit",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "event_frequency": "All",
  "modified": "2024-03-13 12:59:12.736955",
  "module": "Advantisquartz",
  "name": "Add Purchase receipt item to gate entry",
  "reference_doctype": "Purchase Receipt",
  "script": "if doc.gate_entry: \n    gate_entry = doc.gate_entry\n    gate_doc = frappe.get_doc('Gate Entry', gate_entry)\n    for item in doc.items:\n        if item.linked_to_gate_entry == 0:\n            gate_doc.append(\"stock_item_tab\", {\n                        'item': item.item_code,\n                        'qty': item.qty + item.rejected_qty,\n                        'uom' : item.uom\n                    })\n            item.linked_to_gate_entry = 1\n    doc.save()\n    gate_doc.save()",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": "serial",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2024-02-27 11:57:22.976656",
  "module": "Advantisquartz",
  "name": "serial",
  "reference_doctype": null,
  "script": "a = frappe.form_dict[\"serial_name\"]\n\nitem_code = frappe.db.sql('SELECT item_code FROM `tabSerial No` where name=%s', a,as_dict=True)\nitem_name = frappe.db.sql('SELECT item_name FROM `tabSerial No` where name=%s', a,as_dict=True)\ngross_weight = frappe.db.sql('SELECT gross_weight FROM `tabSerial No` where name=%s', a,as_dict=True)\nlength = frappe.db.sql('SELECT length FROM `tabSerial No` where name=%s', a,as_dict=True)\nwidth = frappe.db.sql('SELECT width FROM `tabSerial No` where name=%s', a,as_dict=True)\nquality =frappe.db.sql('SELECT quality FROM `tabSerial No` where name=%s ', a,as_dict=True)\ncustom_batch_no = frappe.db.sql('SELECT custom_batch_no FROM `tabSerial No` where name=%s ', a,as_dict=True)\nfrappe.response['name'] = a\nfrappe.response['item_code'] = item_code[0]['item_code']\nfrappe.response['item_name'] = item_name[0]['item_name']\nfrappe.response['gross_weight'] = gross_weight[0]['gross_weight']\nfrappe.response['length'] = length[0]['length']\nfrappe.response['width'] = width[0]['width']\nfrappe.response['quality'] = quality[0]['quality']\nfrappe.response['custom_batch_no']=custom_batch_no[0]['custom_batch_no']",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": "serial_batch",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2023-08-02 18:26:55.521983",
  "module": "Advantisquartz",
  "name": "serial_batch",
  "reference_doctype": null,
  "script": "a = frappe.form_dict[\"serial\"]\n\nlot_no = frappe.db.sql(\"\"\"SELECT custom_batch_no FROM `tabSerial No` WHERE name=%s \"\"\", a)\nlot_no1 = \"\"\n\nfor lot in lot_no:\n    for no_lot in lot:\n        if lot_no1 == \"\":\n            lot_no1 = no_lot\n    \nfrappe.msgprint(a)\nfrappe.msgprint(lot_no1)\nfrappe.response[\"lot_no\"] = lot_no1\n",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": "purchase",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2023-08-02 19:30:36.008511",
  "module": "Advantisquartz",
  "name": "purchase",
  "reference_doctype": null,
  "script": "a =  frappe.form_dict[\"supplier_quotation\"]\nif(a):\n    request = frappe.db.sql(\"select sqi.request_for_quotation from `tabSupplier Quotation` sq join `tabSupplier Quotation Item` sqi on sq.name = sqi.parent where sq.name = %s\",a, as_dict=True)\n    frappe.response[\"request\"]=request[0]['request_for_quotation']",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "Daily",
  "modified": "2024-01-29 18:44:48.913542",
  "module": "Advantisquartz",
  "name": "Leave Allocation",
  "reference_doctype": null,
  "script": "'advantisquartz.advantisquartz.doctype.api.generate_leave_allocation'\n\n",
  "script_type": "Scheduler Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Submit",
  "event_frequency": "All",
  "modified": "2023-09-23 11:19:28.554184",
  "module": "Advantisquartz",
  "name": "QC Link To gate Entry",
  "reference_doctype": "Quality Inspection",
  "script": "if doc.reference_type == \"Purchase Receipt\":\n    gate_entry = frappe.db.get_value(\"Purchase Receipt\",doc.reference_name,'gate_entry')\n    if gate_entry:\n        parent = frappe.get_doc('Gate Entry', gate_entry)\n        parent.append(\"qc_details\", {\n                'qc': doc.name,\n                'item_name': doc.item_name,\n                'qc_status' : doc.status,\n                'qc_date' : doc.report_date,\n                'qc_time': '',\n                'inspected_by': doc.inspected_by,\n                'qc_remarks' : doc.remarks,\n                'sample_size': str(doc.sample_size) +\" \"+ str(doc.sample_uom),\n        }) \n        if (parent.lock_quality_inspection == 0 ):\n            parent.lock_quality_inspection = 1 \n        parent.save()",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Submit",
  "event_frequency": "All",
  "modified": "2023-09-18 18:59:25.549257",
  "module": "Advantisquartz",
  "name": "purchase qty",
  "reference_doctype": "Purchase Receipt",
  "script": "for item in doc.items:\n    # Get the qty field value from the Purchase Order's child table\n    qty = frappe.db.get_value('Purchase Order Item', filters={'parent': item.purchase_order, 'item_code': item.item_code}, fieldname='received_qty')\n    \n    # Do something with the 'qty' value\n    item.po_received_qty = qty",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 1,
  "api_method": "get_mm_child",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2023-09-25 19:02:12.893323",
  "module": "Advantisquartz",
  "name": "Get Machine Maintenance child",
  "reference_doctype": null,
  "script": "mach =  str(frappe.form_dict['mach'])\n\nquery = f\"SELECT * FROM `tabMachine Maintenance Item` WHERE parent = %s and status = %s \"\nresult = frappe.db.sql(query, (mach,'Returnable',), as_dict=True)\n    # frappe.msgprint(result[0].item_name)\nfrappe.response['result'] = result ",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "event_frequency": "All",
  "modified": "2024-07-05 13:23:39.867353",
  "module": "Advantisquartz",
  "name": "Get Overtime",
  "reference_doctype": "Attendance",
  "script": "in_time = str(doc.in_time)\nout_time = str(doc.out_time)\nshift_name = doc.shift\nattendance_name = doc.name\n# frappe.msgprint(in_time)\n# frappe.msgprint(out_time)\n# frappe.msgprint(shift_name)\n# frappe.msgprint(attendance_name)\n\n# For splitting time from in_time and out_time\ntry:\n    new_in_time=in_time.split(\" \")[1:][0]\nexcept IndexError:\n    new_in_time = ''\n    \n    \ntry:\n    new_out_time=out_time.split(\" \")[1:][0]\nexcept IndexError:\n    new_out_time = ''\n    \n    \n# For getting shift hours\nshift_Hour = frappe.db.get_value('Shift Type', shift_name, ['custom_shift_hours'])\nshift_Hour_Str = str(shift_Hour)\nhalf_day_hour = frappe.db.get_value('Shift Type', shift_name, ['working_hours_threshold_for_half_day'])\n# frappe.msgprint(shift_Hour_Str)\n\n#For calculation of Overtime\nif new_in_time and new_out_time:\n    \n    \n    WorkHours = frappe.utils.time_diff(new_out_time, new_in_time)\n    WorkHours_Str = str(WorkHours)\n    # frappe.msgprint(WorkHours_Str)\n    final_wh_new = frappe.utils.format_time(WorkHours_Str,'H.m')\n    # frappe.msgprint(str(final_wh_new))\n    frappe.db.set_value('Attendance', attendance_name, 'custom_work_hours', final_wh_new)\n    \n    if float(final_wh_new) < half_day_hour:\n        frappe.db.set_value('Attendance', attendance_name, 'status', 'Half Day')\n        \n    if WorkHours > shift_Hour:\n        diff = frappe.utils.time_diff(WorkHours_Str, shift_Hour_Str)\n        final_OT = frappe.utils.format_time(diff,'H.m')\n        # frappe.msgprint(str(diff))\n        # frappe.msgprint(str(final_OT))\n        frappe.db.set_value('Attendance', attendance_name, 'custom_overtime', final_OT)\n        \n        ",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2024-02-12 15:30:32.670666",
  "module": "Advantisquartz",
  "name": "batch no. auto create",
  "reference_doctype": "Stock Entry",
  "script": "if doc.is_new():\n    for item in doc.items:\n        if item.is_finished_item == 1:\n            batch_list = frappe.db.get_list('Batch', filters={'item': item.item_code}, fields=['batch_id'], as_list=True)\n            frappe.msgprint(\"Batch List: \" + str(batch_list))\n            batch = frappe.db.get_value(\"Work Order\", doc.work_order, fieldname='lot_no')\n            item.batch_no = batch\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "event_frequency": "All",
  "modified": "2024-01-12 11:26:14.700220",
  "module": "Advantisquartz",
  "name": "Change Status",
  "reference_doctype": "Delivery Note",
  "script": "if doc.docstatus == 2:\n        packing_list_name = doc.packing_scanner\n        if packing_list_name:\n            packing_list_doc = frappe.get_doc('Packing list', packing_list_name)\n            \n            for item in packing_list_doc.items:\n                serial_nos = item.get('serial_no', '').split('\\n')\n                for serial_no in serial_nos:\n                    if serial_no:\n                        frappe.db.set_value('Serial No', serial_no, 'status', 'Hold')\n            \n            frappe.db.set_value('Packing list', packing_list_name, 'delivered', 0)\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Delete",
  "event_frequency": "All",
  "modified": "2024-01-30 11:50:02.835235",
  "module": "Advantisquartz",
  "name": "Change status serial no after delete item",
  "reference_doctype": "Packing list",
  "script": "if doc.docstatus == 0:\n    for item in doc.items:\n        serial_no = item.serial_no  # Get serial number from the item\n        if serial_no:\n            # Fetch the status of the serial number from 'Serial No' doctype\n            serial_doc = frappe.get_doc('Serial No', serial_no)\n            # frappe.msgprint(message)\n            for item in serial_doc.name:\n                status = serial_doc.packing_list\n    \n                # Display the serial number and its status using msgprint\n                message = f\"Serial No: {serial_no}, Status: {status}\"\n                # frappe.db.set_value('Serial No', serial_no, 'packing_list' ,doc.name)\n                frappe.db.set_value('Serial No', serial_no, {'status': 'Active', 'packing_list': ''})\n\n                \n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": "set_submit",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "event_frequency": "All",
  "modified": "2024-01-19 10:54:19.170775",
  "module": "Advantisquartz",
  "name": "Submit Machine Maintenance Log",
  "reference_doctype": "Machine Maintenance Log",
  "script": "reference_name = frappe.form_dict[\"reference_name\"]\n\nmachine_maintenance_logs = frappe.get_list(\n    'Machine Maintenance Log',\n    filters={\n        'machine_maintenance_schedule': reference_name,\n        'maintenance_status': 'Planned'\n    },\n    fields=['name']\n)\n\nfor log in machine_maintenance_logs:\n    machine_maintenance_log = frappe.get_doc('Machine Maintenance Log', log['name'])\n\n    machine_maintenance_log.completion_date = frappe.utils.today()\n    machine_maintenance_log.maintenance_status = 'Completed'\n\n    machine_maintenance_log.submit()\n\nfrappe.response[\"reference_name\"] = reference_name\n",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "event_frequency": "All",
  "modified": "2024-02-23 11:16:27.418601",
  "module": "Advantisquartz",
  "name": "Consumed Value Set The Work Order Item",
  "reference_doctype": "Stock Entry",
  "script": "for item in doc.items:\n    if doc.stock_entry_type == \"Manufacture\" and item.is_finished_item == 0 and  item.item_code != item.custom_consumed_material_item_code:\n        frappe.db.set_value('Work Order Item', {'parent': doc.work_order, 'item_code': item.custom_consumed_material_item_code}, {'custom_consumed_item_code': item.item_code,'consumed_qty':item.qty})",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Delete",
  "event_frequency": "All",
  "modified": "2024-02-23 11:16:22.529026",
  "module": "Advantisquartz",
  "name": "delete consumed material",
  "reference_doctype": "Stock Entry",
  "script": "for item in doc.items:\n    if doc.stock_entry_type == \"Manufacture\" and item.is_finished_item == 0 and item.item_code == item.custom_consumed_material_item_code:\n        frappe.db.set_value('Work Order Item', {'parent': doc.work_order, 'item_code': item.custom_consumed_material_item_code}, 'custom_consumed_item_code', '')",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": "packing_list",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2024-02-29 12:50:27.792687",
  "module": "Advantisquartz",
  "name": "packing_list",
  "reference_doctype": null,
  "script": "a = frappe.form_dict[\"packing_list\"]\nitem_code = frappe.db.sql(\"\"\"SELECT item_code, serial_no,batch_no,container_no,sales_length,sales_weight,sales_grade,saleable_measurement FROM `tabPacking List Item` WHERE   parent=%s  \"\"\", a)\n\n\nfrappe.response[\"item_code\"] = item_code\n",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2024-11-05 18:12:13.500458",
  "module": "Advantisquartz",
  "name": "Validate Purchase Receipt For Existing Gate Entry Details Before Insert",
  "reference_doctype": "Purchase Receipt",
  "script": "if doc.amended_from == \"\":\n    existing_pr = frappe.get_list(\n        \"Purchase Receipt\",\n        filters={\n            \"supplier\": doc.supplier,\n            \"bill_no\": doc.bill_no,\n            \"bill_date\": doc.bill_date,\n            \"gate_entry\": doc.gate_entry\n        },\n        fields=[\"name\"]\n    )\n    \n    if existing_pr:\n        frappe.throw(\"Gate Entry Already Exists Against This Supplier With the Same Invoice No. and Date.\")",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "event_frequency": "All",
  "modified": "2024-06-21 16:28:54.922296",
  "module": "Advantisquartz",
  "name": "Hide component",
  "reference_doctype": "Salary Slip",
  "script": "components_to_remove = [\"After Leave\", \"Base\"]\n    \nsalary_child = doc.get(\"earnings\")\n    \nfiltered_earnings = []\nfor component in salary_child:\n    if component.salary_component not in components_to_remove:\n        filtered_earnings.append(component)\n    \ndoc.earnings = filtered_earnings\n    \n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": "bulk_update_machine_maintenance_items",
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "event_frequency": "All",
  "modified": "2024-11-05 18:41:55.391571",
  "module": "Advantisquartz",
  "name": "Bulk Update machine maintainance Items",
  "reference_doctype": "Purchase Receipt",
  "script": "mm_ids = frappe.form_dict[\"mm_ids\"]\n# Ensure mm_ids is a list\nif isinstance(mm_ids, str):\n    mm_ids = json.loads(mm_ids)\n        \n# Update all records in one database call\nfor mm_id in mm_ids:\n    doc = frappe.get_doc(\"Machine Maintenance Item\", mm_id)\n    doc.returned = 1\n    doc.save()\n    \nfrappe.db.commit()\n",
  "script_type": "API"
 }
]